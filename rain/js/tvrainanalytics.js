function inet_aton(t){if(t){for(var a=t.split("."),e=new ArrayBuffer(4),i=new DataView(e),n=0;n<4;n++)i.setUint8(n,a[n]);return i.getUint32(0)}return""}var TvrainAnalytics={data:{},host:"//stat.tvrain.tv",timestart:Math.round((new Date).getTime()/1e3),time_video:0,video_position:0,video_position_max:0,video_id:0,payTrackLogin:!1,windowActive:!1,time_on_page:0,init:function(t,a){var e=this;if(this.is_active=a,Array.prototype.forEach.call(document.querySelectorAll("script"),(function(t){if(t.src.indexOf("/static/app/build/all.min.js")>-1){var a=t.src.split("?")[1];if(a&&"tvrain.tv"===location.host){var i=new XMLHttpRequest;i.open("GET",e.host+"/revision?"+a),i.send()}}})),!this.is_active)return!1;$(window).blur(function(){this.windowActive=!1}.bind(this)),$(window).focus(function(){this.windowActive=!0}.bind(this)),t.referer=document.referrer,t.title=document.title,t.is_paid_content=dfp_is_paid,t.inet_aton=inet_aton(t.ip),this.data=t,"undefined"!=typeof AdaptiveHelper&&(this.data.page_version=(new AdaptiveHelper).getBreakpointName()),$.ajax({url:this.host+"/views/",data:this.data,async:!1,success:function(t,a,e){if("undefined"!=typeof TVRAIN&&void 0!==TVRAIN.geo){var i=e.getResponseHeader("X-Geo-City");i&&"Or"==i.substr(0,2)&&"l"==i.substr(3,1)&&(i="Orel"),TVRAIN.geo.city=i,TVRAIN.geo.country.code=e.getResponseHeader("X-Geo-CountryCode"),TVRAIN.geo.country.name=e.getResponseHeader("X-Geo-CountryName")}}}),pingIntervalId=setInterval(function(){1==this.windowActive&&(this.time_on_page+=5),this.time_on_page>86400&&clearInterval(pingIntervalId),"undefined"!=typeof wsq&&wsq.send({type:"update",data:{video_position_max:this.video_position_max,video_position:this.video_position,time_on_page:this.time_on_page,time_video:this.time_video}}),this.video_position>0&&$.ajax({url:this.host+"/ping/v1/",data:{hash_view:this.data.hash_view,time_on_page:this.time_on_page,time_video:Math.round(this.time_video),video_position:Math.round(this.video_position),video_id:Math.round(this.video_id),uid:this.data.user_id}})}.bind(this),5e3)},event:function(t,a,e,i,n){if(!this.is_active)return!1;var r={};r.user_id=this.data.user_id,r.hash_view=this.data.hash_view,r.hash_long=this.data.hash_long,r.hash_session=this.data.hash_session,r.category=t,r.action=a,r.label=e,r.value=i,r.version=n,r.is_subscriber=this.data.is_subscriber,$.ajax({url:this.host+"/event/",data:r})},eventc:function(t,a,e,i,n){if(!this.is_active)return!1;var r={};r.category=t,r.action=a,r.label=e,r.value=i,r.version=n,$.ajax({url:this.host+"/eventc/",data:r})},genGuid:function(){for(var t="qwertyuiopasdfghjklzxcvbnm1234567890",a="",e=0;e<16;e++)a+=t[Math.floor(Math.random()*t.length)];return a},trackPageView:function(t){$.ajax({url:"/api/stat/view/",data:t})},gaTrackLink:function(t){var a=$(t.currentTarget).data().gaParams;a.article_id>0&&"site"==TvrainAnalytics.data.controller&&"index"==TvrainAnalytics.data.action&&(a.page_version=TvrainAnalytics.data.page_version,$.post("/site/track/",a)),gtag("event",a.category,{send_to:"widgetTracker",event_category:a.category,event_action:"click",event_label:a.label})},frontTrackLink:function(t){var a=$(t.currentTarget).data().gaParams;(new AdaptiveHelper).getBreakpointName();a.article_id>0&&"site"==TvrainAnalytics.data.controller&&"index"==TvrainAnalytics.data.action&&(a.page_version=TvrainAnalytics.data.page_version,$.post("/site/track/",a)),gtag("event",a.category,{send_to:"abTracker",event_category:a.category,event_action:"click",event_label:a.label})},statTrackLink:function(t){var a=$(t.currentTarget).data().gaParams;TvrainAnalytics.event(a.category,"click",a.label,a.value)},statTrack:function(t){var a=$(t.currentTarget).data().statTrack,e=a.category||"",i=a.action||"",n=a.label||"",r=a.value||"";TvrainAnalytics.event(e,i,n,r,!0)},statPayTrack:function(t){var a=$(t.currentTarget).data().payParams;("purchase/login"!=a.label&&"purchase/registration"!=a.label||!this.payTrackLogin)&&("purchase/login"!=a.label&&"purchase/registration"!=a.label||(this.payTrackLogin=!0),TvrainAnalytics.event("pay","click",a.label,a.value,!0))},trackWidgetShow:function(t){var a=$(t).data().gaParams;gtag("event",a.category,{send_to:"widgetTracker",event_category:a.category,event_action:"show"})},trackWidgetABShow:function(t){var a=$(t).data().gaParams;gtag("event",a.category,{send_to:"abTracker",event_category:a.category,event_action:"show"})},gaABCTrackLink:function(t){var a=$(t.currentTarget).data().gaParams;gtag("event",a.category,{send_to:"abcTracker",event_category:a.category,event_action:"show",event_label:a.label})}};$((function(){$(document).delegate("[data-ga-track-link]","click",TvrainAnalytics.gaTrackLink),$(document).delegate("[data-front-track-link]","click",TvrainAnalytics.frontTrackLink),$(document).delegate("[data-stat-track-link]","click",TvrainAnalytics.statTrackLink),$(document).delegate("[data-abc-widget-track]","click",TvrainAnalytics.gaABCTrackLink),$(document).delegate("[data-pay-params]","click",TvrainAnalytics.statPayTrack),$(document).delegate("[data-stat-track]","click",TvrainAnalytics.statTrack),$("[data-ga-track-widget-show]").each((function(){TvrainAnalytics.trackWidgetShow(this)})),$("[data-ga-track-ab-widget-show]").each((function(){TvrainAnalytics.trackWidgetABShow(this)}))}));