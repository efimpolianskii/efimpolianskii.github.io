<!DOCTYPE html><html lang="en">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5726911142858125"
    crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZW3F596G5R"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-ZW3F596G5R');
  </script>
    
     <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>$(function(){$("#footer").load("../parts/footer.html");});</script> <!--Loading Footer-->
  <script>$(function(){$("#navbar").load("../parts/navbar.html");});</script> <!--Loading Navbar-->
  <script>$(function(){$("#links").load("../parts/links.html");});</script> <!--Loading Links-->
  <script>$(function(){$("#random").load("../parts/random.html");});</script> <!--Loading Random Article-->

    
    <link rel="stylesheet" href="../css/style.css">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Hello nerds! Today I want to tell you about another important element in the SQL query language, namely subqueries. Subqueries are a very important thing for those who want to learn how to pull more complex data from the database and analyze it in more detail. I will try to write the most detailed and understandable guide on how to figure it out and how you can understand it. (by the way, a very detailed explanation of the logic of the join operator in SQL was recently published on our website. I advise you to read it). In SQL, a subquery is a query nested within another query. The subquery is used to retrieve data that will be used by the main query as a filter condition or a value in a comparison. In simpler terms, a subquery allows us to filter data by adding just a few rows, instead of using the with statement, which newbies are so easily confused with. Let's look at the example of a small database. In the future, all examples of subqueries will be based on this database.">
    <meta name="author" content="BecomingNerd">
    <meta name="keywords" content="SQL Subqueries, Non-correlated subqueries, correlated subqueries, subqueries examples, left join postgre, left join guide, detailed guide left join sql, group by SQL">
    <meta name="generator" content="">
    <title>SQL Subqueries | The Most Detailed Explanation and Guide Ever</title>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">


        <!-- Favicons -->

    <link rel="icon" href="../images/favicon.ico" sizes="32x32" type="image/png">
    <link rel="icon" href="../images/favicon.ico" sizes="16x16" type="image/png">
    <link rel="mask-icon" color="#808080">
    <link rel="icon" href="../images/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;900&family=Ubuntu&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css" integrity="sha384-QYIZto+st3yW+o8+5OHfT6S482Zsvz2WfOzpFSXMF9zqeLcFV0/wlZpMtyFcZALm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.2/css/all.min.css" integrity="sha512-3M00D/rn8n+2ZVXBO9Hib0GKNpkm8MSUU/e2VNthDyBYxKWG+BftNYYcuEjXlyrSO637tidzMBXfE7sQm0INUg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../css/style.css">
    <meta name="theme-color" content="#808080">
    <!-- Custom styles for this template -->
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900&amp;display=swap" rel="stylesheet">
    <!-- Custom styles for this template -->
  </head>
  <body>

<style>

pre {
  background-color: #f4f4f4;
  font-size: 14px;
  font-family: "Courier New", Courier, monospace;
  border-radius: 5px;
  overflow-x: auto;
}

pre code {
  display: block;
  padding: 0;
  margin: 0;
  overflow-x: auto;
  font-family: "Courier New", Courier, monospace;
  font-size: 14px;
  line-height: 1.5;
}
.code-block {
  position: relative;
}

#copy-btn {
  position: absolute;
  top: 5px;
  right: 5px;
}
.hover-window {
  position: relative;
  display: inline-block;
}

.hover-content {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1;
  width: 150px;
  height: 100px;
  background-color: #fff;
  border: 1px solid #ccc;
  padding: 10px;
  display: none;
}

.hover-window:hover .hover-content {
  display: block;
}


    </style>
    
<div id="navbar"></div>

	<div class="progress-container">
		<div class="progress-bar" id="myBar"></div>
	</div>

<main class="container" style="padding-top: 50px;">
    

  <div class="row g-5">
    <div class="col-md-8">
      <article class="blog-post">
        <h1 class="blog-post-title mb-1">SQL Subqueries | The Most Detailed Explanation and Guide Ever</h1>
        <span><p class="blog-post-meta">March 17, 2023 • 100% Human Written • by <a href="https://www.reddit.com/user/P_01y">u/P_01y</a></p></span>

        <p>Hello nerds! Today I want to tell you about another important element in the <a href="worth-SQL.html">SQL</a> query language, namely subqueries. Subqueries are a very important thing for those who want to learn how to pull more complex data from the database and analyze it in more detail. I will try to write the most detailed and understandable guide on how to figure it out and how you can understand it. (by the way, a very detailed explanation of the logic of the join operator in SQL was recently published on our website. I advise you to <a href="sql-join.html">read it</a>).</p>
        <p>In SQL, a subquery is a query nested within another query. The subquery is used to retrieve data that will be used by the main query as a filter condition or a value in a comparison. In simpler terms, a subquery allows us to filter data by adding just a few rows, instead of using the with statement, which newbies are so easily confused with. Let's look at the example of a small database. In the future, all examples of subqueries will be based on this database.</p>
        
        <p><a href="https://resumeio.sjv.io/c/3876500/1503720/17609?subId1=becomingnerd"><img src="../blogs/images/resumeio.jpeg" style="padding: 10px 0;"/></a></p>

        <div style="overflow-x:auto;">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col">emp_id</th>
                <th scope="col">first_name</th>
                <th scope="col">last_name</th>
                <th scope="col">salary</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td>John</td>
                <td>Smith</td>
                <td>53.000</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>John</td>
                <td>Doe</td>
                <td>56.000</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td>Bob</td>
                <td>Reynalds</td>
                <td>43.500</td>
              </tr>
            </tbody>
          </table>
        </div>

        <p>Now let's set ourselves the task of finding out all the information about employees whose wages are above average. To get started, let's just write a query that calculates the average salary for all employees.</p>

        <div class="code-block">
          <pre><code>
  SELECT AVG(salary) FROM employees;                   
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>

        <p>Now that such a simple query is built, we can use it as a condition for comparison, a condition for inequality. <a href="learning-SQL.html">SQL</a> makes it easy for us to do this. It is enough to put the above query in brackets.</p>

        <div class="code-block">
          <pre><code>
  SELECT * FROM employees 
    WHERE salary > (SELECT AVG(salary) FROM employees);                   
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>

        <p>What have we done? In fact, we combined two requests - we asked: to calculate the average salary for employees and display those who have this salary above the average. For simplicity, I would recommend that you always read such queries from a subquery. Thus, you will immediately understand which information you filter out first, and which is just general.</p>
        <p>Someone could already guess that subqueries can and should be used in another way. You can use them in two parts of the query - after the <i>WHERE</i> argument and after the <i>SELECT</i> argument. Let's take them in order.</p>
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5726911142858125"
              crossorigin="anonymous"></script>
        <ins class="adsbygoogle"
              style="display:block"
              data-ad-format="fluid"
              data-ad-layout-key="-fb+5w+4e-db+86"
              data-ad-client="ca-pub-5726911142858125"
              data-ad-slot="8075272857"></ins>
        <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

        <h2>Correlated subqueries</h2>
        <p>It is not necessary to memorize their names. The main thing is to understand their essence and how the two types of subqueries differ from each other. In a correlated subquery, the subquery references a column from the outer query. The subquery is executed once for each row in the outer query. Correlated subqueries can be slower than non-correlated subqueries because they have to be executed multiple times. In simple terms, this kind of subquery is used after the <i>SELECT</i> argument and can easily be replaced with a <i>GROUP BY</i> argument.</p>
      
        <div class="code-block">
          <pre><code>
  SELECT name, 
    (SELECT COUNT(name) FROM employees) AS names_count
    FROM employees;                           
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>This query counts the number of employees with the same name. As I said, it could well be replaced by a <i>GROUP BY</i>. Here everyone decides what is more convenient. Personally, subqueries have always seemed more convenient and understandable to me. Here's what the solution to this problem would look like if you wanted to use <i>GROUP BY</i>:</p>
        <div class="code-block">
          <pre><code>
  SELECT name, AVG(salary) AS avg_salary
    FROM employees; 
    GROUP BY name;                         
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p><i>GROUP BY</i> is faster and more capacious, but again, everyone chooses what to use and in what specific case.</p>

        <h2>Non-correlated subqueries</h2>
        <p>This type of subquery is not so easy to replace with an equivalent. In a non-correlated subquery, the subquery does not reference any column from the outer query. The subquery is executed once and its result is used by the main query.</p>
        <p>In simple words, we use this type of subquery after the statement <i>WHERE</i> or <i>FROM</i> and this opens up huge opportunities for us to filter a huge array of data.</p>
        <p>For example, we can find out employees whose salary is higher than the average, as at the very beginning of our article, or calculate what is the biggest difference between salaries, that is, which employees have the largest delta:</p>
        <div class="code-block">
          <pre><code>
  SELECT MAX(salary_delta) AS largest_salary_delta
    FROM (
      SELECT MAX(salary) - MIN(salary) AS salary_delta
        FROM employees
        GROUP BY id
    ) subquery;                              
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>In this query, we first calculate the difference of all charges (we read the query from the subquery, as I recommended), and then from all the differences we select the maximum.</p>
        <p>I will give another query example, but this time we will build a subquery after the keyword <i>WHERE</i>.</p>
        <div class="code-block">
          <pre><code>
  SELECT name, AVG(salary)
    WHERE (SELECT COUNT(name) FROM employees) > 1
    FROM employees;                             
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>So, the entire query will return the names of all employees and their average salary, but only if there is more than one employee in the "employees" table. I'll explain in as much detail as possible:</p>
        <div class="code-block">
          <pre><code>
  SELECT name, AVG(salary)                           
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>This part of the code specifies the columns to be selected in the query result. It selects the "name" column and the average salary of all employees.</p>
        <div class="code-block">
          <pre><code>
  WHERE (SELECT COUNT(name) FROM employees) > 1                            
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>This is a <i>WHERE</i> condition that checks if the number of employees in the "employees" table is greater than one. It does this by using a subquery that counts the number of rows in the "employees" table. This condition is used to ensure that the <i>AVG</i> function is not called when there is only one employee in the table, which would result in a division by zero error.</p>
        <div class="code-block">
          <pre><code>
  FROM employees;                            
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>This specifies the table from which the data is being selected. In this case, it is the "employees" table.</p>
        <p>Feel free to understand the code, even if everyone says that it is very simple. Ask someone who is busy or, if you are still embarrassed to seem dull (which I do not advise you), seek help from <a href="chatgpt-usage.html">AI</a>, who will explain any code to you in great detail and clearly (but there may be errors, understand this).</p>
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5726911142858125"
              crossorigin="anonymous"></script>
        <ins class="adsbygoogle"
              style="display:block"
              data-ad-format="fluid"
              data-ad-layout-key="-fb+5w+4e-db+86"
              data-ad-client="ca-pub-5726911142858125"
              data-ad-slot="8075272857"></ins>
        <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        
        <h2>Euler Example</h2>
        <p>You know that I love explaining technical stuff with the <a href="euler-diagram.html">Euler diagram</a>. Now, as another example, I will try to convey the received material to you visually, through these very diagrams.</p>
        <p>Imagine we have two sets. In one set, there are numbers that are a multiple of three, that is, they are divisible by 3 without a remainder, and in the other set, there are numbers that are a multiple of 5, that is, they are divisible by 5 without a remainder. It is logical to assume that the intersection of these sets will be numbers that are multiples of both 5 and 3, that is, 15, 30, 45, and so on, as shown in my figure:</p>
        <img src="../blogs/images/Subqueries - Euler Diagrams.png" alt="Subqueries - Euler Diagrams">
        <p class="image-desc text-center">Subqueries - Euler Diagrams</p>
        <p>This problem can be easily solved using subqueries.</p>
        <div class="code-block">
          <pre><code>
  SELECT *
    FROM B 
    WHERE (SELECT * FROM A WHERE number%5==0);                           
          </code></pre>
          <button id="copy-btn" onclick="copyCode()" class="btn btn-outline-dark btn-sm">Copy Query</button>
        </div>
        <p>It is a <a href="learning-SQL.html">SQL</a> query that selects all columns and rows from table B, where the result of a subquery is true. This subquery selects all columns and rows from table A where the value in the "number" column is divisible by 5 without any remainder. The main query then filters the results from table B based on the result of the subquery. Specifically, only rows from table B are returned where the subquery returns one or more rows.</p>
        <h2>Conclusion</h2>
        <p>I really hope that my explanation seemed to you much clearer than most on the net. First of all, I tried to explain to you the logic and principle by which subqueries are built, and not the syntax itself - you can see this for yourself. I always adhere to the idea - first understand the logic, and then write with your hands. Good luck!</p>
      </article>

      <nav class="blog-pagination" aria-label="Pagination">
        <a class="btn btn-outline-primary rounded-pill" href="../search.html" style="font-family: 'Ubuntu';">More</a>
      </nav>

    </div>

    <div class="col-md-4">
      <div class="position-sticky" style="top: 5rem;">
        <div id="random"></div>
        
        <div>
          <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
              <strong class="d-inline-block mb-2 text-primary">New</strong>
              <h3 class="mb-0" style="font-family: 'Ubuntu';">List of 5 Best SQL Learning Resources IMHO</h3>
              <div class="mb-1 text-muted">Dec 23</div>
              <p class="card-text mb-auto">Without the words about importance SQL and its popularity, I start my list...</p>
              <a href="../blogs/learning-SQL.html" class="stretched-link">Continue reading</a>
            </div>
          </div>
        </div>
        <div>
          <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
              <strong class="d-inline-block mb-2 text-success">Popular</strong>
              <h3 class="mb-0" style="font-family: 'Ubuntu';">Left Join in SQL | The Most Detailed Explanation and Guide Ever</h3>
              <div class="mb-1 text-muted">Mar 10</div>
              <p class="card-text mb-auto">Hello colleagues! Today I decided to write probably the most selective tutorial on the...</p>
              <a href="../blogs/sql-join.html" class="stretched-link">Continue reading</a>
            </div>
          </div>
        </div>
        <div>
          <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
              <strong class="d-inline-block mb-2 text-success">Popular</strong>
              <h3 class="mb-0" style="font-family: 'Ubuntu';">Is SQL Worth Learning in 2023? 5 Reasons to Learn SQL</h3>
              <div class="mb-1 text-muted">Feb 3</div>
              <p class="card-text mb-auto">SQL is used in many jobs in IT. Literally every specialist, whether he is junior or senior, whether...</p>
              <a href="../blogs/worth-SQL.html" class="stretched-link">Continue reading</a>
            </div>
          </div>
        </div>
        <div>
          <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
              <strong class="d-inline-block mb-2 text-success">Popular</strong>
              <h3 class="mb-0" style="font-family: 'Ubuntu';">Top 5 hard skills to get any job you like in IT</h3>
              <div class="mb-1 text-muted">Jan 11</div>
              <p class="card-text mb-auto">The list presented in this article is my opinion. It can...</p>
              <a href="../blogs/best-hard-skills.html" class="stretched-link">Continue reading</a>
            </div>
          </div>
        </div>
        <div>
          <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
              <strong class="d-inline-block mb-2 text-primary">New</strong>
              <h3 class="mb-0" style="font-family: 'Ubuntu';">Best Ways How to Stand out in Competitive IT Sphere</h3>
              <div class="mb-1 text-muted">Jan 23</div>
              <p class="card-text mb-auto">Probably you are already accustomed to the fact that my articles are more a sharing of experience, rather than scientific works. This time I decided not to deviate ...</p>
              <a href="../blogs/competitive-it.html" class="stretched-link">Continue reading</a>
            </div>
          </div>
        </div>
        
        <div id="links"></div>
        
      </div>
    </div>
    
  </div>
</main>
<div id="footer"></div>
<script>
function copyCode() {
  /* Get the text inside the code block */
  var code = document.querySelector("pre code");
  var text = code.innerText;
  
  /* Create a temporary input element */
  var tempInput = document.createElement("input");
  tempInput.setAttribute("value", text);
  document.body.appendChild(tempInput);
  
  /* Select the text inside the input element */
  tempInput.select();
  document.execCommand("copy");
  
  /* Remove the temporary input element */
  document.body.removeChild(tempInput);
  
  /* Update the button text */
  var copyBtn = document.getElementById("copy-btn");
  copyBtn.textContent = "Copied!";
}
</script>
<script src="../js/random-article.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="becomingnerd" data-description="Support BecomingNerd on Buy me a coffee!" data-message="" data-color="#808080" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</body></html>